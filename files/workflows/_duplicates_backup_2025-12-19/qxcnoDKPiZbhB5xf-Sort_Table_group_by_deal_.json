{
  "name": "Sort Table (group by deal)",
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -800,
        48
      ],
      "id": "10a324dd-bf0d-44c7-a59e-4085bd074728",
      "name": "Manual Trigger"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1WmjK9uCbI8Vm38FkSN92dfKByNWRBL3NjcimRPo3gLI",
          "mode": "list",
          "cachedResultName": "Result",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1WmjK9uCbI8Vm38FkSN92dfKByNWRBL3NjcimRPo3gLI/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1054397373,
          "mode": "list",
          "cachedResultName": "сводная таблица",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1WmjK9uCbI8Vm38FkSN92dfKByNWRBL3NjcimRPo3gLI/edit#gid=1054397373"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -544,
        48
      ],
      "id": "b357be6e-cc99-44ec-93c5-769805782c87",
      "name": "Get all rows (source)",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "4YuM90VIJt7fxZFx",
          "name": "Google Sheets account 3"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1WmjK9uCbI8Vm38FkSN92dfKByNWRBL3NjcimRPo3gLI",
          "mode": "list",
          "cachedResultName": "Result",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1WmjK9uCbI8Vm38FkSN92dfKByNWRBL3NjcimRPo3gLI/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2016259679,
          "mode": "list",
          "cachedResultName": "Сортерованная таблица",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1WmjK9uCbI8Vm38FkSN92dfKByNWRBL3NjcimRPo3gLI/edit#gid=2016259679"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        48,
        48
      ],
      "id": "eada1cf2-e7b7-4f09-b0f3-0b7c9998d015",
      "name": "Append deal rows (target)",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "4YuM90VIJt7fxZFx",
          "name": "Google Sheets account 3"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Group all rows by 'Сделка' (extract deal number like 'Сделка 00009079').\nconst rows = items.map(i => i.json || i);\nif(!rows.length) return [];\nconst groups = {};\nrows.forEach(r => {\n  const s = (r['Сделка'] || '').toString();\n  // Capture digits after 'Сделка', allow normal spaces and NBSP\n  const m = s.match(/Сделка[  ]*([0-9]+)/);\n  const key = m ? (`Сделка ${m[1]}`) : s.trim();\n  (groups[key] = groups[key] || []).push(r);\n});\nconst out = [];\nObject.keys(groups).sort().forEach(k => groups[k].forEach(r => out.push(r)));\nreturn out.map(r => ({ json: r }));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [
        -256,
        48
      ],
      "id": "d3501efa-6d53-481a-926c-d5a9ac123aed",
      "name": "Group by Deal1"
    }
  ],
  "pinData": {},
  "connections": {
    "Manual Trigger": {
      "main": [
        [
          {
            "node": "Get all rows (source)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get all rows (source)": {
      "main": [
        [
          {
            "node": "Group by Deal1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Group by Deal1": {
      "main": [
        [
          {
            "node": "Append deal rows (target)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "030ea028-d9c7-4d95-840f-885aee0ffb22",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "id": "qxcnoDKPiZbhB5xf"
}